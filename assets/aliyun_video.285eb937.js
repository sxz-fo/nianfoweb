import{u as f,o,ar as w,cp as h,bF as v,a as k,b6 as x,_,aw as F,bd as W,n as j,as as L,f as l,W as S,Y as O,aP as P,Z as C}from"./index.583ded0e.js";import{a as M}from"./useUtil.a480a79b.js";import{O as z}from"./icon.435067f9.js";import{H as A,a as I,A as R}from"./hls.5bed1a25.js";import{c as V}from"./Layout.0a02d4ec.js";import"./api.7f2baa4b.js";import"./index.a3f69cd9.js";import"./index.ce87ac65.js";import"./Markdown.5916ce5b.js";import"./index.63d29e53.js";import"./FolderTree.2a97c636.js";const J=()=>{const{replace:m}=f(),{proxyLink:c}=M();let n=o.objs.filter(e=>e.type===z.VIDEO);n.length===0&&(n=[o.obj]);let i,s={id:"player",container:"#video-player",title:o.obj.name,volume:.5,autoplay:w("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,quality:[],plugins:[],whitelist:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:"m3u8",customType:{m3u8:function(e,t){const r=new A;r.loadSource(t),r.attachMedia(e),e.src||(e.src=t)}},lang:["en","zh-cn","zh-tw"].includes(h().toLowerCase())?h().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};V&&(s.moreVideoAttr.controls=!0);const u=o.related.find(e=>{for(const t of[".srt",".ass",".vtt"])if(e.name.endsWith(t))return!0;return!1}),d=o.related.find(e=>{for(const t of[".xml"])if(e.name.endsWith(t))return!0;return!1});u&&(s.subtitle={url:c(u,!0),type:v(u.name)}),d&&(s.plugins=[I({danmuku:c(d,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"})]);const{pathname:y}=f(),[g,b]=k(()=>x.post("/fs/other",{path:y(),password:_(),method:"video_preview"}));return F(async()=>{const e=await b();W(e,t=>{const r=t.video_preview_play_info.live_transcoding_task_list.filter(a=>a.url);if(r.length===0){j.error("No transcoding video found");return}s.url=r[r.length-1].url,s.quality=r.map((a,p)=>({html:a.template_id,url:a.url,default:p===r.length-1})),i=new R(s),i.on("video:ended",()=>{const a=n.findIndex(p=>p.name===o.obj.name);a<n.length-1&&m(n[a+1].name)})})}),L(()=>{i==null||i.destroy()}),l(C,{get loading(){return g()},get children(){return l(S,{w:"$full",spacing:"$2",get children(){return[l(O,{w:"$full",h:"60vh",id:"video-player"}),l(P,{onChange:e=>{m(e)},get value(){return o.obj.name},get options(){return n.map(e=>({value:e.name}))}})]}})}})};export{J as default};
